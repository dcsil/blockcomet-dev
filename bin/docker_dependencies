#!/usr/bin/env bash

install_postgres() {
  if [ "$(uname)" == "Darwin" ]; then
    brew cask list | grep postgres > /dev/null 2>&1
    if [ $? -eq 1 ] && [ ! -d /Applications/Postgres.app ]; then
      brew cask install postgres
    else
      echo "postgres already installed"
      open /Applications/Postgres.app
    fi
  else
    command -v psql > /dev/null 2>&1
    if [ $? -eq 0 ]; then
      echo "postgres already installed"
    else
      apt-get update
      apt install postgresql postgresql-contrib
    fi
  fi
}

install_homebrew() {
  if [ "$(uname)" == "Darwin" ]; then
    echo "Installing Homebrew"
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  fi
}

install_node() {
  echo "Installing Node"
  if [ "$(uname)" == "Darwin" ]; then
    brew install node
  else
    apt-get update
    apt-get install nodejs
  fi
}

install_python() {
  echo "Installing Python"
  if [ "$(uname)" == "Darwin" ]; then
    brew install python3.6 
  else
    apt-get update
    apt-get install python3.6  
  fi
}

install_yarn() {
  echo "Installing Yarn"
  if [ "$(uname)" == "Darwin" ]; then
    brew install yarn
  else
    curl -o- -L https://yarnpkg.com/install.sh | bash
  fi
}

command -v curl > /dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "Curl already installed"
else
  apt install curl # No-ops in Linux
fi


command -v brew > /dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "Homebrew already installed"
else
  install_homebrew # No-ops in Linux
fi

command -v curl > /dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "Curl already installed"
else
  apt install curl # No-ops in Linux
fi


command -v node > /dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "node already installed"
else
  install_node
fi

# install python 3.6
command -v python > /dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "python already installed"
else
  install_python
fi

# install docker-compose if Linux 
command -v docker-compose > /dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "docker-compose already installed"
else
  curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
  chmod +x /usr/local/bin/docker-compose
fi

# install poetry 
# curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -
command -v poetry > /dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "poetry already installed"
else
cmd=$(curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -)
echo ${cmd}
fi

command -v yarn > /dev/null 2>&1
if [ $? -eq 0 ]; then
  echo "yarn already installed"
else
  install_yarn
fi